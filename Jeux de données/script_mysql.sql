-- Créaton du schéma
CREATE SCHEMA SALES;
USE SALES;

set sql_safe_updates=0;

-- Table Region

CREATE TABLE Region(
   idRegion INT,
   nomRegion VARCHAR(50),
   PRIMARY KEY(idRegion)
);

LOAD DATA INFILE 'C://Users/calib/OneDrive/Bureau/data/REGION.csv'
INTO TABLE Region
FIELDS TERMINATED BY ';'
LINES TERMINATED BY '\r\n';


-- Table LigneProduit

CREATE TABLE LigneProduit(
   idLigne INT,
   nom VARCHAR(50),
   PRIMARY KEY(idLigne)
);

LOAD DATA INFILE 'C://Users/calib/OneDrive/Bureau/data/LIGNEPRODUIT.csv'
INTO TABLE LigneProduit
FIELDS TERMINATED BY ';'
LINES TERMINATED BY '\r\n';


-- Table Produit

CREATE TABLE Produit(
   idProduit INT,
   codeProduit VARCHAR(50),
   idLigne INT,
   PRIMARY KEY(idProduit),
   FOREIGN KEY(idLigne) REFERENCES LigneProduit(idLigne)
);

LOAD DATA INFILE 'C://Users/calib/OneDrive/Bureau/data/PRODUIT.csv'
INTO TABLE Produit
FIELDS TERMINATED BY ';' 
LINES TERMINATED BY '\r\n';


-- Table Pays

CREATE TABLE Pays(
   idPays INT,
   nomPays VARCHAR(50),
   idRegion INT,
   PRIMARY KEY(idPays),
   FOREIGN KEY(idRegion) REFERENCES Region(idRegion)
);

LOAD DATA INFILE 'C://Users/calib/OneDrive/Bureau/data/PAYS.csv'
INTO TABLE Pays
FIELDS TERMINATED BY ';' 
LINES TERMINATED BY '\r\n';


-- Table Ville

CREATE TABLE Ville(
   idVille INT,
   ville VARCHAR(50),
   idPays INT,
   PRIMARY KEY(idVille),
   FOREIGN KEY(idPays) REFERENCES Pays(idPays)
);

LOAD DATA INFILE 'C://Users/calib/OneDrive/Bureau/data/VILLE.csv'
INTO TABLE Ville
FIELDS TERMINATED BY ';' 
LINES TERMINATED BY '\r\n';


-- Table Client

CREATE TABLE Client(
   idClient INT,
   nomContact VARCHAR(50),
   adresse1 VARCHAR(50),
   adresse2 VARCHAR(50),
   prenomContact VARCHAR(50),
   téléphoneContact VARCHAR(50),
   nomEntreprise VARCHAR(50),
   idVille INT,
   PRIMARY KEY(idClient),
   FOREIGN KEY(idVille) REFERENCES Ville(idVille)
);

LOAD DATA INFILE 'C://Users/calib/OneDrive/Bureau/data/CLIENT.csv'
INTO TABLE Client
FIELDS TERMINATED BY ';' 
LINES TERMINATED BY '\r\n';


-- Table Commande

CREATE TABLE Commande(
   numCommande INT,
   dateCommandetext VARCHAR(20),
   quantité INT,
   prixUnite DOUBLE,
   idProduit INT NOT NULL,
   idClient INT NOT NULL,
   dateCommande DATE,
   PRIMARY KEY(numCommande),
   FOREIGN KEY(idProduit) REFERENCES Produit(idProduit),
   FOREIGN KEY(idClient) REFERENCES Client(idClient)
);

LOAD DATA INFILE 'C://Users/calib/OneDrive/Bureau/data/COMMANDE.csv'
INTO TABLE Commande
FIELDS TERMINATED BY ';' 
LINES TERMINATED BY '\r\n';

UPDATE Commande SET dateCommande = STR_TO_DATE(dateCommandetext, '%m/%d/%Y');

ALTER TABLE Commande
DROP dateCommandetext;